<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Pro Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- PWA: manifest e cor da barra -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff4500">

  <style>
    :root { --primary: #ff4500; --bg: #f0f2f5; }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      display: flex;
      justify-content: center;
      padding: 20px;
      margin: 0;
    }
    .box {
      background: #fff;
      padding: 22px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 480px;
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 14px;
      font-size: 1.3rem;
    }
    p { font-size: 0.9rem; color: #555; }
    label {
      display: block;
      margin-top: 14px;
      font-size: 0.85rem;
      color: #666;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 13px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      margin-top: 18px;
      font-weight: 600;
      cursor: pointer;
    }
    button:active { opacity: 0.9; }

    .market-group { display: flex; gap: 10px; margin-top: 8px; }
    .market-option {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      border: 2px solid #eee;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.2s;
      background: #fff;
    }
    .market-option img {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    .market-option span {
      font-size: 0.85rem;
      font-weight: 500;
    }
    .market-option.active {
      border-color: var(--primary);
      background: #fff5f0;
    }

    .radio-group {
      display: flex;
      gap: 15px;
      margin-top: 8px;
    }
    .radio-group label {
      margin-top: 0;
      font-weight: normal;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .tag-tax {
      font-size: 0.75rem;
      color: #999;
      margin-top: 5px;
    }

    .res {
      margin-top: 18px;
      padding: 15px;
      background: #fff8f5;
      border-radius: 8px;
      display: none;
      border: 1px solid #ffe0d5;
    }
    .res-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }
    .total {
      font-size: 1rem;
      font-weight: bold;
      color: #d35400;
      border-top: 1px solid #eee;
      padding-top: 8px;
      margin-top: 8px;
    }
    #login-screen { text-align: center; }
  </style>

  <!-- PWA: registro do service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js')
          .then(function () {
            console.log('Service Worker registrado com sucesso');
          })
          .catch(function (err) {
            console.log('Erro ao registrar Service Worker:', err);
          });
      });
    }
  </script>
</head>
<body>

<div class="box" id="login-screen">
  <h2>Acesso Restrito</h2>
  <p>Digite a senha de acesso:</p>
  <input type="password" id="senhaInput" placeholder="Senha">
  <button onclick="verificarSenha()">Entrar</button>
</div>

<div class="box" id="app-screen" style="display:none;">
  <h2>Calculadora Pro Marketplace</h2>
  
  <label>Selecione o Marketplace</label>
  <div class="market-group">
    <div class="market-option active" id="btn-shopee" onclick="selecionarMarketplace('shopee')">
      <img src="https://i.ibb.co/HpGxgVv/shopee-logo.png" alt="Shopee">
      <span>Shopee</span>
    </div>
    <div class="market-option" id="btn-ml" onclick="selecionarMarketplace('ml')">
      <img src="https://logospng.org/download/mercado-livre/logo-mercado-livre-4096.png" alt="ML">
      <span>Mercado Livre</span>
    </div>
  </div>
  <input type="hidden" id="mkt" value="shopee">

  <div id="opcoes-shopee">
    <label>Tipo de conta Shopee</label>
    <div class="radio-group">
      <label><input type="radio" name="tipoShopee" value="cnpj" checked> CNPJ</label>
      <label><input type="radio" name="tipoShopee" value="cpf"> CPF</label>
    </div>
    <div class="tag-tax">Taxas aproximadas: CNPJ ~20% | CPF ~21% (Frete Grátis)</div>
  </div>

  <div id="opcoes-ml" style="display:none;">
    <label>Tipo de anúncio Mercado Livre</label>
    <div class="radio-group">
      <label><input type="radio" name="tipoML" value="classico" checked> Clássico</label>
      <label><input type="radio" name="tipoML" value="premium"> Premium</label>
    </div>
    <div class="tag-tax">Taxas aproximadas: Clássico ~13% | Premium ~18%</div>
  </div>

  <label>Custo do Produto (R$)</label>
  <input type="number" id="custo" placeholder="0,00">

  <label>Frete / Coleta (R$)</label>
  <input type="number" id="frete" value="0">

  <label>Seu Imposto (%)</label>
  <input type="number" id="imposto" value="6">

  <label>Margem de Lucro Desejada (%)</label>
  <input type="number" id="lucro" value="30">

  <button onclick="calcular()">CALCULAR PREÇOS</button>

  <div id="resultado" class="res"></div>
</div>

<script>
  const SENHA_MESTRE = "123456"; 
  const TAXAS = {
    shopee: { cnpj: 20, cpf: 21 },
    ml: { classico: 13, premium: 18 }
  };

  function verificarSenha() {
    const input = document.getElementById('senhaInput').value;
    if (input === SENHA_MESTRE) {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app-screen').style.display = 'block';
    } else {
      alert("Senha incorreta!");
    }
  }

  function selecionarMarketplace(market) {
    document.getElementById('mkt').value = market;
    document.getElementById('btn-shopee').classList.remove('active');
    document.getElementById('btn-ml').classList.remove('active');
    document.getElementById('btn-' + market).classList.add('active');

    if (market === 'shopee') {
      document.getElementById('opcoes-shopee').style.display = 'block';
      document.getElementById('opcoes-ml').style.display = 'none';
    } else {
      document.getElementById('opcoes-shopee').style.display = 'none';
      document.getElementById('opcoes-ml').style.display = 'block';
    }
  }

  function calcular() {
    const mkt = document.getElementById('mkt').value;
    const custo = parseFloat(document.getElementById('custo').value) || 0;
    const frete = parseFloat(document.getElementById('frete').value) || 0;
    const impostoPerc = (parseFloat(document.getElementById('imposto').value) || 0) / 100;
    const lucroPerc = (parseFloat(document.getElementById('lucro').value) || 0) / 100;

    if (custo <= 0) {
      alert("Informe o custo do produto.");
      return;
    }

    let taxaMktPercent;
    if (mkt === 'shopee') {
      const tipo = document.querySelector('input[name="tipoShopee"]:checked').value;
      taxaMktPercent = TAXAS.shopee[tipo];
    } else {
      const tipo = document.querySelector('input[name="tipoML"]:checked').value;
      taxaMktPercent = TAXAS.ml[tipo];
    }

    const taxaMkt = taxaMktPercent / 100;
    const divisor = 1 - (taxaMkt + impostoPerc + lucroPerc);

    if (divisor <= 0) {
      alert("Soma de taxa + imposto + lucro >= 100%. Reduza os percentuais.");
      return;
    }

    const custoTotal = custo + frete;
    const precoBase = custoTotal / divisor;
    const precoPromo = precoBase * 1.20;

    const resDiv = document.getElementById('resultado');
    resDiv.style.display = 'block';
    resDiv.innerHTML = `
      <div class="res-item"><strong>Custo Total:</strong> <span>R$ ${custoTotal.toFixed(2)}</span></div>
      <div class="res-item"><strong>Taxa Marketplace (${taxaMktPercent}%):</strong> <span>R$ ${(precoBase * taxaMkt).toFixed(2)}</span></div>
      <div class="res-item"><strong>Impostos:</strong> <span>R$ ${(precoBase * impostoPerc).toFixed(2)}</span></div>
      <div class="res-item"><strong>Lucro:</strong> <span>R$ ${(precoBase * lucroPerc).toFixed(2)}</span></div>
      <div class="total"><span>Preço de Venda Ideal:</span> <span>R$ ${precoBase.toFixed(2)}</span></div>
      <hr style="border:none;border-top:1px dashed #ddd;margin:10px 0;">
      <div class="total" style="color:#27ae60;"><span>Preço p/ Promo (+20%):</span> <span>R$ ${precoPromo.toFixed(2)}</span></div>
      <p style="font-size:0.75rem;color:#777;margin-top:5px;">Use o preço de promoção como valor cheio para poder dar descontos em campanhas.</p>
    `;
  }

  selecionarMarketplace('shopee');
</script>

</body>
</html>
